<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Jesus’s Family Tree — Mobile</title>
  <link rel="icon" href='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="%237c3aed"/><stop offset="100%" stop-color="%233b82f6"/></linearGradient></defs><rect width="64" height="64" rx="14" fill="%2310222e"/><g fill="url(%23g)"><rect x="28" y="10" width="8" height="44" rx="2"/><rect x="14" y="24" width="36" height="8" rx="2"/></g></svg>' />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body { height: 100%; }
    body { background: #0b1220; touch-action: manipulation; }
    .hide-scrollbar::-webkit-scrollbar { display: none; }
    .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

    .snap-x-mandatory { scroll-snap-type: x mandatory; }
    .snap-center { scroll-snap-align: center; }

    .clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }

    .ripple { position: relative; overflow: hidden; touch-action: manipulation; }
    .ripple:after { content:""; position:absolute; width:0; height:0; left:var(--x,50%); top:var(--y,50%);
      background:rgba(255,255,255,.25); border-radius:9999px; transform:translate(-50%,-50%);
      transition:width .35s ease, height .35s ease, opacity .5s ease; pointer-events:none; }
    .ripple:active:after { width:200px; height:200px; opacity:0; }

    .cardM { background: linear-gradient(135deg, #1c2a4a, #0f172a); }
    .cardF { background: linear-gradient(135deg, #2a1c4a, #0f172a); }

    .tab-active { box-shadow: inset 0 -2px 0 0 rgba(99,102,241,1); color: #c7d2fe; }

    input, textarea, select { font-size: 16px; }
  </style>
</head>
<body class="text-slate-100 selection:bg-indigo-300 selection:text-slate-900">

  <!-- App -->
  <section class="flex flex-col h-full">
    <!-- Header -->
    <header class="shrink-0 px-4 pt-4 pb-3 bg-gradient-to-b from-slate-900 to-slate-800/60 backdrop-blur">
      <div class="flex items-center gap-3">
        <div class="size-9 rounded-xl bg-indigo-500 grid place-items-center shadow-md shadow-indigo-900/40">
          <span class="text-sm font-bold">JT</span>
        </div>
        <div class="flex-1">
          <h1 class="text-lg font-semibold leading-tight">Jesus’s Family Tree</h1>
          <p class="text-xs text-slate-300">Swipe siblings • Go up/down • Tap for details • View list by book</p>
        </div>
        <button id="infoBtn" class="ripple text-xs px-3 py-2 rounded-lg bg-slate-700/60">About</button>
      </div>

      <!-- Tabs -->
      <div class="mt-3 flex gap-2 text-sm">
        <button id="tabTree" class="ripple px-3 py-2 rounded-lg bg-slate-800 ring-1 ring-slate-700 tab-active">Tree</button>
        <button id="tabList" class="ripple px-3 py-2 rounded-lg bg-slate-800 ring-1 ring-slate-700">List</button>
        <div class="flex-1"></div>
        <div class="relative w-1/2 max-w-sm">
          <input id="search" type="text" inputmode="search" placeholder="Search: Adam, Noah, David, Jesus..."
                 class="w-full rounded-xl bg-slate-800/80 px-4 py-3 pr-10 outline-none ring-1 ring-slate-700 focus:ring-indigo-400 text-sm" />
          <svg class="absolute right-3 top-1/2 -translate-y-1/2 size-5 opacity-70" viewBox="0 0 24 24" fill="none">
            <path d="m21 21-4.3-4.3M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="currentColor" stroke-width="1.5"/>
          </svg>
        </div>
        <button id="homeBtn" class="ripple px-3 py-2 rounded-lg bg-slate-800 ring-1 ring-slate-700 text-xs">Home</button>
      </div>
    </header>

    <!-- Breadcrumb path -->
    <div id="crumbs" class="shrink-0 px-4 py-2 flex items-center gap-2 overflow-x-auto hide-scrollbar"></div>

    <!-- Main area: Tree view -->
    <main id="viewTree" class="grow relative overflow-hidden">
      <div class="flex flex-col h-full">
        <!-- Sticky lane under breadcrumbs/header -->
        <div id="laneWrap" class="sticky top-0 z-10 px-4 pt-1 pb-3 bg-gradient-to-b from-slate-900/95 to-slate-900/30 backdrop-blur">
          <div id="lane" class="px-0 overflow-x-auto hide-scrollbar snap-x-mandatory flex items-center gap-4"></div>
        </div>

        <!-- Scrollable contemporaries/content area -->
        <div class="flex-1 overflow-y-auto px-4 pb-40">
          <div id="coPanel" class="mx-auto max-w-md rounded-xl bg-slate-900/95 border border-slate-700 shadow-[0_8px_28px_rgba(0,0,0,0.35)] p-2 mt-2">
            <div class="flex items-center justify-between gap-2">
              <div class="text-[11px] font-semibold text-slate-200">Contemporaries</div>
              <div id="coSpan" class="text-[10px] text-slate-400"></div>
            </div>
            <div class="mt-1 flex items-center gap-2 text-[10px]">
              <span class="text-slate-400">Filter:</span>
              <div class="inline-flex rounded-lg ring-1 ring-slate-700 overflow-hidden">
                <button id="filterAll" class="px-2 py-0.5 bg-slate-800 tab-active">All</button>
                <button id="filter1" class="px-2 py-0.5 bg-slate-800">±1 gen</button>
                <button id="filter2" class="px-2 py-0.5 bg-slate-800">±2 gen</button>
              </div>
            </div>
            <div id="coList" class="mt-1 space-y-1.5 max-h-[60vh] overflow-y-auto pr-1 hide-scrollbar"></div>
          </div>
        </div>

        <!-- Bottom bar: up/down + meta (still fixed) -->
        <div class="shrink-0 fixed inset-x-0 bottom-0 p-3">
          <div class="mx-auto max-w-md">
            <div class="rounded-2xl bg-slate-900/95 border border-slate-700 shadow-[0_20px_60px_rgba(0,0,0,0.35)] p-2">
              <div class="grid grid-cols-3 gap-2 items-stretch">
                <button id="upBtn" class="ripple rounded-xl bg-slate-800 py-3 text-sm font-medium">↑ Parents</button>
                <button id="focusBtn" class="ripple rounded-xl bg-indigo-600 py-3 text-sm font-semibold">Details</button>
                <button id="downBtn" class="ripple rounded-xl bg-slate-800 py-3 text-sm font-medium">↓ Children</button>
              </div>
              <div id="meta" class="mt-2 text-center text-[11px] text-slate-300"></div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- List view -->
    <section id="viewList" class="hidden grow overflow-y-auto px-4 pb-24">
      <div id="listContainer" class="max-w-md mx-auto py-4 space-y-4"></div>
    </section>

    <!-- Details Sheet -->
    <section id="sheet" class="pointer-events-none fixed inset-x-0 bottom-0 z-10 translate-y-full transition-transform duration-300">
      <div class="pointer-events-auto rounded-t-2xl bg-slate-900/95 border-t border-slate-700 shadow-[0_-20px_60px_rgba(0,0,0,0.35)] p-4">
        <div class="mx-auto max-w-md">
          <div class="flex items-start gap-3">
            <div id="sheetAvatar" class="size-10 shrink-0 rounded-xl bg-indigo-500/80 grid place-items-center shadow-inner">
              <span class="text-sm font-bold">—</span>
            </div>
            <div class="flex-1">
              <h3 id="sheetTitle" class="text-base font-semibold">Name</h3>
              <p id="sheetSub" class="text-xs text-slate-300"></p>
            </div>
            <button id="closeSheet" class="ripple rounded-lg px-3 py-2 bg-slate-800">Close</button>
          </div>
          <div id="sheetBody" class="mt-3 text-sm leading-6 text-slate-200"></div>
        </div>
      </div>
    </section>
  </section>

  <script>
    // ------- Data (with rough AM chronology + NT figures) -------
    const NODES = [
      { id:"adam", name:"Adam", gender:"m", blurb:"According to Genesis, the first man. Father of Cain, Abel, and Seth.", children:["cain","abel","seth"], parents:[], book:"Genesis", born:0, died:930 },
      { id:"eve", name:"Eve", gender:"f", blurb:"The first woman; mother of all living. Partner of Adam.", children:["cain","abel","seth"], parents:[], book:"Genesis", born:0, died:930 },
      { id:"cain", name:"Cain", gender:"m", blurb:"Eldest son of Adam and Eve. Known for killing his brother Abel.", parents:["adam","eve"], children:[], book:"Genesis", born:130, died:1040 },
      { id:"abel", name:"Abel", gender:"m", blurb:"Second son of Adam and Eve; a shepherd whose offering pleased the LORD.", parents:["adam","eve"], children:[], book:"Genesis", born:129, died:161 },
      { id:"seth", name:"Seth", gender:"m", blurb:"Son of Adam and Eve given after Abel; from his line comes Noah.", parents:["adam","eve"], children:["enos"], book:"Genesis", born:130, died:1042 },
      { id:"enos", name:"Enosh", gender:"m", blurb:"Grandson of Adam through Seth. In his days people began to call on the LORD.", parents:["seth"], children:["noah_ancestor"], book:"Genesis", born:235, died:1140 },
      { id:"noah_ancestor", name:"(Generations)", gender:"m", blurb:"Generations between Enosh and Noah summarized for compact view.", parents:["enos"], children:["noah"], book:"Genesis", born:400, died:1055 },
      { id:"noah", name:"Noah", gender:"m", blurb:"Builder of the ark; preserved through the flood. Father of Shem, Ham, and Japheth.", parents:["noah_ancestor"], children:["shem","ham","japheth"], book:"Genesis", born:1056, died:2006 },
      { id:"shem", name:"Shem", gender:"m", blurb:"Son of Noah; ancestral line leading to Abraham.", parents:["noah"], children:["abraham_ancestor"], book:"Genesis", born:1558, died:2158 },
      { id:"ham", name:"Ham", gender:"m", blurb:"Son of Noah; ancestor of various nations.", parents:["noah"], children:[], book:"Genesis", born:1558, died:1998 },
      { id:"japheth", name:"Japheth", gender:"m", blurb:"Son of Noah; ancestor of many coastland peoples.", parents:["noah"], children:[], book:"Genesis", born:1558, died:2000 },
      { id:"abraham_ancestor", name:"(Generations)", gender:"m", blurb:"Generations between Shem and Abram summarized for clarity.", parents:["shem"], children:["abraham"], book:"Genesis", born:1700, died:1950 },
      { id:"abraham", name:"Abraham", gender:"m", blurb:"Called by God; covenant bearer. Father of Ishmael and Isaac.", parents:["abraham_ancestor"], children:["ishmael","isaac"], book:"Genesis", born:1948, died:2123 },
      { id:"sarah", name:"Sarah", gender:"f", blurb:"Wife of Abraham; mother of Isaac.", parents:[], children:["isaac"], book:"Genesis", born:1958, died:2085 },
      { id:"hagar", name:"Hagar", gender:"f", blurb:"Egyptian servant of Sarah; mother of Ishmael.", parents:[], children:["ishmael"], book:"Genesis", born:1970, died:2050 },
      { id:"ishmael", name:"Ishmael", gender:"m", blurb:"Son of Abraham; ancestor of many nations.", parents:["abraham","hagar"], children:[], book:"Genesis", born:2034, died:2171 },
      { id:"isaac", name:"Isaac", gender:"m", blurb:"Son of Abraham and Sarah; father of Esau and Jacob.", parents:["abraham","sarah"], children:["esau","jacob"], book:"Genesis", born:2048, died:2228 },
      { id:"rebekah", name:"Rebekah", gender:"f", blurb:"Wife of Isaac; mother of Esau and Jacob.", parents:[], children:["esau","jacob"], book:"Genesis", born:2088, died:2208 },
      { id:"esau", name:"Esau", gender:"m", blurb:"Elder twin of Jacob; ancestor of Edom.", parents:["isaac","rebekah"], children:[], book:"Genesis", born:2108, died:2268 },
      { id:"jacob", name:"Jacob (Israel)", gender:"m", blurb:"Son of Isaac; renamed Israel. Father of the twelve tribes.", parents:["isaac","rebekah"], children:["judah","joseph","levi","reuben","simeon","issachar","zebulun","dan","naphtali","gad","asher","benjamin"], book:"Genesis", born:2108, died:2255 },
      { id:"judah", name:"Judah", gender:"m", blurb:"Fourth son of Jacob; royal line leading to David.", parents:["jacob"], children:["david_ancestor"], book:"Genesis", born:2196, died:2315 },
      { id:"joseph", name:"Joseph", gender:"m", blurb:"Son of Jacob; rose to power in Egypt and preserved his family.", parents:["jacob"], children:[], book:"Genesis", born:2199, died:2309 },
      { id:"levi", name:"Levi", gender:"m", blurb:"Tribe of priests descends from him.", parents:["jacob"], children:[], book:"Genesis", born:2195, died:2332 },
      { id:"reuben", name:"Reuben", gender:"m", blurb:"Firstborn of Jacob.", parents:["jacob"], children:[], book:"Genesis", born:2193, died:2287 },
      { id:"simeon", name:"Simeon", gender:"m", blurb:"Second son of Jacob.", parents:["jacob"], children:[], book:"Genesis", born:2194, died:2293 },
      { id:"issachar", name:"Issachar", gender:"m", blurb:"One of Jacob’s sons.", parents:["jacob"], children:[], book:"Genesis", born:2199, died:2319 },
      { id:"zebulun", name:"Zebulun", gender:"m", blurb:"One of Jacob’s sons.", parents:["jacob"], children:[], book:"Genesis", born:2201, died:2311 },
      { id:"dan", name:"Dan", gender:"m", blurb:"One of Jacob’s sons.", parents:["jacob"], children:[], book:"Genesis", born:2207, died:2288 },
      { id:"naphtali", name:"Naphtali", gender:"m", blurb:"One of Jacob’s sons.", parents:["jacob"], children:[], book:"Genesis", born:2208, died:2288 },
      { id:"gad", name:"Gad", gender:"m", blurb:"One of Jacob’s sons.", parents:["jacob"], children:[], book:"Genesis", born:2208, died:2288 },
      { id:"asher", name:"Asher", gender:"m", blurb:"One of Jacob’s sons.", parents:["jacob"], children:[], book:"Genesis", born:2210, died:2310 },
      { id:"benjamin", name:"Benjamin", gender:"m", blurb:"Youngest son of Jacob.", parents:["jacob"], children:[], book:"Genesis", born:2216, died:2316 },
      { id:"david_ancestor", name:"(Generations)", gender:"m", blurb:"Generations from Judah to David summarized.", parents:["judah"], children:["david"], book:"Ruth/1 Chr", born:2700, died:2860 },
      { id:"david", name:"David", gender:"m", blurb:"King of Israel; the shepherd poet from Bethlehem.", parents:["david_ancestor"], children:["jesus_ancestor"], book:"1 Samuel", born:2854, died:2924 },
      { id:"jesus_ancestor", name:"(Generations)", gender:"m", blurb:"Generations from David to Jesus summarized.", parents:["david"], children:["mary","joseph_nz"], book:"Matthew/Luke", born:3200, died:3700 },
      { id:"mary", name:"Mary", gender:"f", blurb:"Mother of Jesus.", parents:["jesus_ancestor"], children:["jesus"], book:"Matthew/Luke", born:3745, died:3805 },
      { id:"joseph_nz", name:"Joseph (of Nazareth)", gender:"m", blurb:"Legal father of Jesus; descendant of David.", parents:["jesus_ancestor"], children:["jesus"], book:"Matthew/Luke", born:3735, died:3795 },
      { id:"jesus", name:"Jesus", gender:"m", blurb:"Central figure of the New Testament; believed by Christians to be the Messiah.", parents:["mary","joseph_nz"], children:[], book:"Gospels", born:3760, died:3793 },
      { id:"johnb", name:"John the Baptist", gender:"m", blurb:"Prophet who prepared the way for Jesus.", parents:[], children:[], book:"Gospels", born:3759, died:3792 },
      { id:"peter", name:"Peter", gender:"m", blurb:"Apostle; fisherman called by Jesus.", parents:[], children:[], book:"Gospels/Acts", born:3745, died:3815 },
      { id:"paul", name:"Paul", gender:"m", blurb:"Apostle to the Gentiles; wrote many epistles.", parents:[], children:[], book:"Acts/Epistles", born:3775, died:3845 },
      { id:"herod", name:"Herod the Great", gender:"m", blurb:"Client king of Judea at Jesus’ birth.", parents:[], children:[], book:"Matthew", born:3712, died:3760 },
      { id:"pilate", name:"Pontius Pilate", gender:"m", blurb:"Roman prefect who presided over the trial of Jesus.", parents:[], children:[], book:"Gospels", born:3740, died:3805 }
    ];

    const byId = Object.fromEntries(NODES.map(n => [n.id, n]));
    const childrenOf = (id) => (byId[id]?.children || []).map(c => byId[c]).filter(Boolean);
    const parentsOf = (id) => (byId[id]?.parents || []).map(p => byId[p]).filter(Boolean);
    function siblingsOfParents(parents) { const set = new Map(); parents.forEach(p => childrenOf(p.id).forEach(c => set.set(c.id, c))); return [...set.values()]; }

    // Generation depth for filters
    const depth = (()=>{ const d={}; const roots=NODES.filter(n=>!n.parents||n.parents.length===0||n.id==='adam'||n.id==='eve'); const q=[]; roots.forEach(r=>{d[r.id]=0;q.push(r.id);}); while(q.length){ const cur=q.shift(); const node=byId[cur]; const base=d[cur]; (node.children||[]).forEach(ch=>{ if(d[ch]==null){ d[ch]=base+1; q.push(ch); } }); } return d; })();
    const genDiff=(a,b)=>{ const da=depth[a], db=depth[b]; if(da==null||db==null) return Infinity; return Math.abs(da-db); };

    // ------- State -------
    let focusId = 'jesus';
    let lane = [];
    let path = ['jesus'];
    let filterRadius = Infinity;

    // ------- DOM -------
    const laneEl = document.getElementById('lane');
    const crumbsEl = document.getElementById('crumbs');
    const upBtn = document.getElementById('upBtn');
    const downBtn = document.getElementById('downBtn');
    const focusBtn = document.getElementById('focusBtn');
    const metaEl = document.getElementById('meta');

    const viewTree = document.getElementById('viewTree');
    const viewList = document.getElementById('viewList');
    const tabTree = document.getElementById('tabTree');
    const tabList = document.getElementById('tabList');

    const filterAll = document.getElementById('filterAll');
    const filter1 = document.getElementById('filter1');
    const filter2 = document.getElementById('filter2');

    // ------- Prevent double-tap / pinch zoom -------
    document.addEventListener('dblclick', (e)=>{ e.preventDefault(); }, { passive:false });
    document.addEventListener('gesturestart', (e)=>{ e.preventDefault(); }, { passive:false });
    let lastTouchTime = 0; document.addEventListener('touchend', (e)=>{ const now = Date.now(); if (now - lastTouchTime < 350) e.preventDefault(); lastTouchTime = now; }, { passive:false });

    // ------- Rendering (Tree) -------
    function renderCrumbs() {
      crumbsEl.innerHTML = '';
      path.forEach((id, idx) => {
        const n = byId[id];
        const b = document.createElement('button');
        b.className = 'ripple shrink-0 px-3 py-1.5 rounded-full text-xs bg-slate-800 ring-1 ring-slate-700 hover:ring-indigo-400';
        b.textContent = n?.name || id;
        b.addEventListener('click', () => jumpToPathIndex(idx));
        crumbsEl.appendChild(b);
        if (idx < path.length-1) {
          const dot = document.createElement('span'); dot.className = 'px-1 text-slate-500'; dot.textContent = '›'; crumbsEl.appendChild(dot);
        }
      });
    }

    function makeCard(n) {
      const hasKids = childrenOf(n.id).length;
      const card = document.createElement('div');
      card.className = `snap-center shrink-0 w-[82vw] max-w-sm rounded-2xl p-4 ring-1 ring-slate-700 shadow-lg ${n.gender==='f'?'cardF':'cardM'}`;
      card.innerHTML = `
        <div class="flex items-start gap-3">
          <div class="size-10 rounded-xl bg-indigo-500/80 grid place-items-center shadow-inner"><span class="text-sm font-bold">${n.name.slice(0,1)}</span></div>
          <div class="flex-1">
            <h3 class="text-lg font-semibold leading-snug">${n.name}</h3>
            <p class="mt-1 text-[13px] text-slate-200 clamp-2">${n.blurb}</p>
            <div class="mt-1.5 flex flex-wrap items-center gap-2 text-[10px]">
              ${parentsOf(n.id).length ? `<span class='px-2 py-0.5 rounded-full bg-slate-800/70'>Parents: ${parentsOf(n.id).map(p=>p.name).join(', ')}</span>`: ''}
              ${hasKids ? `<span class='px-2 py-0.5 rounded-full bg-emerald-700/50 ring-1 ring-emerald-600/60'>Has children: ${hasKids}</span>` : `<span class='px-2 py-0.5 rounded-full bg-slate-700/60'>No children</span>`}
              ${n.born!=null && n.died!=null ? `<span class='px-2 py-0.5 rounded-full bg-slate-800/70'>${n.born}–${n.died}</span>`:''}
            </div>
          </div>
        </div>`;

      card.addEventListener('click', () => setFocus(n.id, {fromTap:true}));
      card.id = `card-${n.id}`;
      return card;
    }

    function renderLane() {
      laneEl.innerHTML = '';
      lane.forEach(n => laneEl.appendChild(makeCard(n)));
      queueMicrotask(() => { const el = document.getElementById(`card-${focusId}`); if (el) el.scrollIntoView({behavior:'instant', inline:'center', block:'nearest'}); });
      const kids = childrenOf(focusId).length; const parents = parentsOf(focusId).length;
      upBtn.disabled = parents === 0; downBtn.disabled = kids === 0;
      upBtn.classList.toggle('opacity-40', parents===0); downBtn.classList.toggle('opacity-40', kids===0);
      downBtn.textContent = kids ? `↓ Children (${kids})` : '↓ No children';
      upBtn.textContent = parents ? '↑ Parents' : '↑ No parents';
      metaEl.textContent = parents? `Parents: ${parentsOf(focusId).map(p=>p.name).join(', ')}` : 'Root generation';
    }

    // ------- Navigation logic -------
    function setFocus(id, opts={}) {
      focusId = id;
      const p = parentsOf(id);
      if (p.length) {
        lane = siblingsOfParents(p);
        const newTrail = buildTrailFromRoot(id); path = newTrail;
      } else {
        lane = ['adam','eve'].map(x=>byId[x]).filter(Boolean);
        path = buildTrailFromRoot(id);
      }
      renderCrumbs();
      renderLane();
      renderContemporaries();
      if (opts.fromTap) openSheet(byId[id]);
    }

    function buildTrailFromRoot(id) { const trail = []; let cur = byId[id]; while (cur) { trail.unshift(cur.id); const ps = parentsOf(cur.id); if (!ps.length) break; cur = ps[0]; } return trail; }

    function goUp() { const ps = parentsOf(focusId); if (!ps.length) return; setFocus(ps[0].id); }

    function goDown() {
      const kids = childrenOf(focusId);
      if (!kids.length) { metaEl.textContent = 'No children for this person'; return; }
      focusId = kids[0].id; lane = kids; path.push(focusId); renderCrumbs(); renderLane(); renderContemporaries();
    }

    function jumpToPathIndex(idx) { const targetId = path[idx]; setFocus(targetId); path = path.slice(0, idx+1); renderCrumbs(); }

    // ------- Contemporaries -------
    function contemporariesOf(id){
      const f = byId[id]; if (!f || f.born==null || f.died==null) return [];
      const span = f.died - f.born; if (span <= 0) return [];
      let list = NODES.filter(n => n.id!==id && n.born!=null && n.died!=null && Math.max(n.born, f.born) < Math.min(n.died, f.died));
      if (filterRadius !== Infinity) list = list.filter(n => genDiff(n.id, id) <= filterRadius);
      list.sort((a,b)=> (a.born - b.born) || (a.died - b.died));
      return list.map(n => {
        const start = Math.max(0, (n.born - f.born)/span);
        const end = Math.min(1, (n.died - f.born)/span);
        return { node:n, start, end };
      });
    }
    const percent = (x)=> Math.round(x*100);

    function renderContemporaries(){
      const f = byId[focusId];
      const co = contemporariesOf(focusId);
      const coList = document.getElementById('coList');
      const coSpan = document.getElementById('coSpan');
      if (!f || !coList) return;
      if (f.born==null || f.died==null){ coSpan.textContent=''; coList.innerHTML = `<div class='text-[11px] text-slate-400'>No timeline data for ${f.name}</div>`; return; }
      coSpan.textContent = `${f.born}–${f.died}`;
      if (!co.length){ coList.innerHTML = `<div class='text-[11px] text-slate-400'>No contemporaries under current filter</div>`; return; }
      coList.innerHTML = '';
      co.forEach(({node,start,end})=>{
        const row = document.createElement('div'); row.className = 'rounded-xl bg-slate-800/70 ring-1 ring-slate-700 p-2';
        const top = document.createElement('div'); top.className='text-[12px] mb-1 flex items-center justify-between gap-2'; top.innerHTML = `<span>${node.name}</span><span class='text-[10px] text-slate-400'>${node.born}–${node.died}</span>`;
        const barWrap = document.createElement('div'); barWrap.className='relative h-2 rounded-full bg-slate-700 overflow-hidden';
        const fill = document.createElement('div'); fill.className='absolute top-0 bottom-0 bg-emerald-500/80'; fill.style.left = `${percent(start)}%`; fill.style.width = `${percent(end-start)}%`;
        const label = document.createElement('div'); label.className='absolute -top-4 right-0 text-[9px] text-slate-300'; label.textContent = `${percent(start)}%–${percent(end)}%`;
        barWrap.appendChild(fill); barWrap.appendChild(label);
        row.appendChild(top); row.appendChild(barWrap);
        row.addEventListener('click', ()=>{ setFocus(node.id); document.getElementById(`card-${node.id}`)?.scrollIntoView({behavior:'smooth', inline:'center', block:'nearest'}); });
        coList.appendChild(row);
      });

      [filterAll, filter1, filter2].forEach(btn=>btn.classList.remove('tab-active'));
      if (filterRadius===Infinity) filterAll.classList.add('tab-active');
      else if (filterRadius===1) filter1.classList.add('tab-active');
      else if (filterRadius===2) filter2.classList.add('tab-active');
    }

    // ------- Details sheet -------
    const sheet = document.getElementById('sheet');
    const sheetTitle = document.getElementById('sheetTitle');
    const sheetSub = document.getElementById('sheetSub');
    const sheetBody = document.getElementById('sheetBody');
    const sheetAvatar = document.getElementById('sheetAvatar');
    document.getElementById('closeSheet').addEventListener('click', ()=> sheet.style.transform = 'translateY(100%)');

    function openSheet(node) { sheetTitle.textContent = node.name; const ps = parentsOf(node.id); sheetSub.textContent = ps.length ? 'Parents: ' + ps.map(p=>p.name).join(', ') : '—'; sheetBody.textContent = node.blurb; sheetAvatar.querySelector('span').textContent = node.name.slice(0,1); sheet.style.transform = 'translateY(0%)'; }

    // ------- Search -------
    const search = document.getElementById('search');
    search.addEventListener('input', ()=>{ const q = search.value.trim().toLowerCase(); if (!q) return; const hit = NODES.find(n => n.name.toLowerCase().includes(q)); if (hit) { if (viewList.classList.contains('hidden')) setFocus(hit.id, {fromTap:false}); centerInList(hit.id); } });

    // ------- Buttons -------
    upBtn.addEventListener('click', goUp);
    downBtn.addEventListener('click', goDown);
    focusBtn.addEventListener('click', ()=> openSheet(byId[focusId]));
    document.getElementById('homeBtn').addEventListener('click', ()=> setFocus('jesus'));
    document.getElementById('infoBtn').addEventListener('click', ()=> openSheet({name:'About', blurb:'Mobile-first, Jesus-centered. No pinch/zoom. Swipe siblings, use ↑ / ↓ for generations. List view by books. Contemporaries show overlaps vs. focused lifespan (0–100%) with generation filters. Minimal dating UI and tighter layout to avoid overlap with breadcrumbs.', parents:[]}));

    filterAll.addEventListener('click', ()=>{ filterRadius = Infinity; renderContemporaries(); });
    filter1.addEventListener('click', ()=>{ filterRadius = 1; renderContemporaries(); });
    filter2.addEventListener('click', ()=>{ filterRadius = 2; renderContemporaries(); });

    // ------- Tabs (Tree/List) -------
    tabTree.addEventListener('click', ()=>{ tabTree.classList.add('tab-active'); tabList.classList.remove('tab-active'); viewTree.classList.remove('hidden'); viewList.classList.add('hidden'); });
    tabList.addEventListener('click', ()=>{ tabList.classList.add('tab-active'); tabTree.classList.remove('tab-active'); viewList.classList.remove('hidden'); viewTree.classList.add('hidden'); });

    // ------- List View (group by book) -------
    const listContainer = document.getElementById('listContainer');
    function buildList() {
      const byBook = {};
      for (const n of NODES) { if (!n.book) continue; (byBook[n.book] ||= []).push(n); }
      const order = ['Genesis','Exodus','Ruth/1 Chr','1 Samuel','Matthew/Luke','Gospels','Acts/Epistles','Gospels/Acts','Matthew'];
      listContainer.innerHTML = '';
      for (const book of order) {
        const arr = (byBook[book]||[]).sort((a,b)=> a.name.localeCompare(b.name));
        if (!arr.length) continue;
        const sec = document.createElement('section');
        sec.innerHTML = `
          <h2 class="text-sm uppercase tracking-wide text-slate-400 mt-2 mb-1">${book}</h2>
          <div class="space-y-2"></div>`;
        const box = sec.querySelector('div');
        arr.forEach(n => {
          const row = document.createElement('button');
          row.className = 'ripple w-full text-left rounded-xl px-3 py-3 bg-slate-800/70 ring-1 ring-slate-700 hover:ring-indigo-400 flex items-center gap-3';
          row.innerHTML = `
            <div class="size-8 rounded-lg bg-indigo-500/80 grid place-items-center"><span class="text-xs font-bold">${n.name.slice(0,1)}</span></div>
            <div class="flex-1">
              <div class="text-sm font-medium">${n.name}</div>
              <div class="text-[11px] text-slate-300 clamp-2">${n.blurb}</div>
            </div>
            <div class="text-[11px] text-slate-400">${n.born!=null? (n.born+'–'+(n.died??'')) : ''}</div>`;
          row.addEventListener('click', ()=>{ setFocus(n.id); tabTree.click(); setTimeout(()=> document.getElementById(`card-${n.id}`)?.scrollIntoView({behavior:'smooth', inline:'center', block:'nearest'}), 0); });
          box.appendChild(row);
        });
        listContainer.appendChild(sec);
      }
    }

    function centerInList(id) {
      const sections = listContainer.querySelectorAll('section');
      for (const sec of sections){ if (sec.textContent.includes(byId[id].name)) { sec.scrollIntoView({behavior:'smooth', block:'start'}); break; } }
    }

    // ------- Init -------
    buildList();
    setFocus('jesus');
  </script>
</body>
</html>
